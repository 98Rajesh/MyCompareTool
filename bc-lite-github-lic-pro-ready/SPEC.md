# BC-Lite â€” Product & Technical Specification

## 1. Overview

BC-Lite is a lightweight, cross-platform file and folder comparison tool inspired by Beyond Compare.
It targets developers and power users who need:

- Fast folder comparison (size / timestamp / content)
- Text file diff (line-based, human-readable)
- Hex-level diff for binaries
- Git integration as an external `difftool` and `mergetool`

The application is implemented in Python using PySide6 (Qt) and distributed as a single-file executable
on Windows, Linux and macOS using PyInstaller.

## 2. Target Platforms

- Windows 10+ (x64)
- Linux (x86_64 desktop, X11/Wayland with Qt)
- macOS 12+ (Apple Silicon & Intel, depending on Python/Qt support)

## 3. User Personas

1. **Embedded / Firmware Developer**
   - Needs to compare binaries (`.bin`, `.hex`) at byte level
   - Wants quick checks of firmware releases and configuration files

2. **Software Engineer (Git User)**
   - Uses Git for source control
   - Wants a graphical diff/merge tool for code reviews and conflict resolution

3. **Power User / DevOps / Sysadmin**
   - Compares directory structures between deployments/servers
   - Verifies backups and artifact builds

## 4. Major Features

### 4.1 Folder Compare

- Select left and right folders via a GUI dialog.
- Traverse directories recursively and list files as relative paths.
- For each item show:
  - Relative path
  - Left size
  - Right size
  - Status:
    - `Left only`
    - `Right only`
    - `Equal`
    - `Different`
- Comparison modes:
  - `size_time`: compare by file size + integer-truncated mtime
  - `content`: optional SHA-256 hashing to confirm equality
- Display results in a tree/table widget with sortable columns.

### 4.2 File Diff (Text)

- Allow user to select two files for comparison.
- Detect binary vs text (simple NUL-byte heuristic).
- For text:
  - Decode using chardet where possible; fallback to UTF-8 with replacement.
  - Compare line-based content using Myers O(ND) diff algorithm.
  - Render diff with simple markers:
    - `"    "` for unchanged lines
    - `"-   "` for deletions (left only)
    - `"+   "` for insertions (right only)
- Read-only view; no editing in this version.

### 4.3 Hex Diff Viewer (Binary)

- Allow user to select two files (binary or text).
- Display both sides in hex + ASCII representation:
  - 16 bytes per row (configurable constant).
  - Row format: `00000000: 41 42 43 ...  | ABC...`
- Byte-level comparison:
  - Show matching bytes as plain hex.
  - Wrap differing bytes in square brackets: `[4F]` vs `[5A]`.
- Intended for diagnosing differences in firmware binaries, executables, etc.

### 4.4 Git Integration

#### 4.4.1 Diff Tool

- Provide `app/git_wrapper.py` as the command invoked by Git.
- Behavior for difftool:
  - Called with `left` and `right` file paths (argv).
  - Launch BC-Lite in `--git-diff left right` mode.
  - Block until user closes the diff window.
  - Return exit code 0 to Git if process exits normally; 1 on failure.

#### 4.4.2 Merge Tool

- Same wrapper also acts as mergetool.
- Git provides `LOCAL`, `REMOTE`, `BASE`, `MERGED` environment variables.
- Wrapper calls BC-Lite with:
  - `--git-merge --local LOCAL --remote REMOTE --base BASE --merged MERGED` (BASE optional).
- Merge UI:
  - Opens a modal dialog:
    - Displays paths for local, remote, base, merged.
    - Loads texts from these files (if present).
    - Performs best-effort 3-way merge using `merge_text` from `three_way_merge.py`.
    - Shows result in a text editor.
  - Buttons:
    - **Save**: writes merged text to `MERGED` file; dialog returns `saved = True`.
    - **Cancel**: discards; `saved = False`.
- Exit code semantics:
  - 0 if user saved successfully (Git treats as merge resolved).
  - Non-zero if user cancels or write fails (Git leaves conflict unresolved).

### 4.5 HTML Diff Report (CLI)

- CLI script: `scripts/report_cli.py`.
- Arguments:
  - `--left <file>`
  - `--right <file>`
  - `--out <html>`
- Uses Myers diff to create a simple HTML report with CSS highlighting of equal/insert/delete lines.

## 5. Non-Functional Requirements

- **Performance**
  - Folder compare must handle tens of thousands of files reasonably fast.
  - Hashing is optional (opt-in) to avoid unnecessary overhead.
- **Responsiveness**
  - Long operations should avoid blocking UI where practical (future enhancement: move to worker threads).
- **Portability**
  - No OS-specific APIs in core logic; PySide6 for GUI ensures cross-platform behavior.
- **Installability**
  - Single-file binaries generated by PyInstaller for each platform.
  - Can also run from source using Python + `pip install -r requirements.txt`.

## 6. Architecture Overview

- `app/main.py`
  - Application entry point and GUI composition.
  - Parses CLI flags for Git integration (`--git-diff`, `--git-merge`).
  - Manages main window and optional modal merge dialog.

- `app/diff.py`
  - Implementation of Myers diff and HTML diff generator.

- `app/folder_compare.py`
  - Directory walking, data model, and file comparison (size/time or hash).

- `app/three_way_merge.py`
  - Simple 3-way merge algorithm, emitting conflict markers for ambiguous regions.

- `app/git_wrapper.py`
  - CLI front-end for Git difftool/mergetool.
  - Launches `main.py` with appropriate arguments and returns exit codes.

- `app/hex_viewer.py` (extension)
  - Hex diff viewer widget for binary comparison.

- `scripts/report_cli.py`
  - CLI entry for HTML diff generation.

## 7. Security Considerations

- Application reads files from user-specified paths; no automatic network access.
- No elevation or system-level changes are performed.
- When used with Git, paths come from local repository working copy or index.

## 8. Future Enhancements

- Multi-threaded hashing and directory scanning.
- Richer diff rendering (syntax highlighting, intra-line differences).
- Full 3-pane visual merge with per-conflict controls and keyboard shortcuts.
- FTP/SFTP remote folder comparison.
- Rule-based ignore filters for file types and patterns.
